---
title: "Machine Learning with TensorFlow and R"
author: "J.J. Allaire<br/>rstudio::conf 2018"
output: 
  ioslides_presentation:
    widescreen: true
    logo: rstudio.png
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = FALSE)
```

<style type="text/css">
.illustration {
  border: solid 1px #cccccc;
</style>


## Overview

- TensorFlow Basics

- R Interfaces to TensorFlow

- Deep Learning

- Case Studies

- Learning More

## What is TensorFlow? | *A general purpose numerical computing library*

- Hardware independent
    - CPU (via C++ library [Eigen](http://eigen.tuxfamily.org/))
    - GPU (via [CUDA](https://en.wikipedia.org/wiki/CUDA))
    - TPU ([Tenor Processing Unit](https://en.wikipedia.org/wiki/Tensor_processing_unit))
    - Others...
    
- Supports distributed execution and very large datasets

- Supports [automatic differentiation](https://en.wikipedia.org/wiki/Automatic_differentiation)

## What are tensors? | *Data stored in multidimensional arrays*

| Dimension | R object  | 
|---|---|
| 0D | `42` | 
| 1D | `c(42, 42, 42)` 
| 2D | `matrix(42, nrow = 2, ncol = 2)`  |
| 3D | `array(42, dim = c(2,3,2))` |
| 4D | `array(42, dim = c(2,3,2,3))` |

## Some examples

- *Vector data*—2D tensors of shape `(samples, features)`
 
- *Timeseries or sequence data*—3D tensors of shape `(samples, timesteps,
features)`
 
- *Images*—4D tensors of shape `(samples, height, width, channels)`


- *Video*—5D tensors of shape `(samples, frames, height, width, channels)` 


## 2D Tensors | *Vector data*

```{r, echo = TRUE}
head(data.matrix(iris), n = 10)
```
```
      Sepal.Length Sepal.Width Petal.Length Petal.Width Species
 [1,]          5.1         3.5          1.4         0.2       1
 [2,]          4.9         3.0          1.4         0.2       1
 [3,]          4.7         3.2          1.3         0.2       1
 [4,]          4.6         3.1          1.5         0.2       1
 [5,]          5.0         3.6          1.4         0.2       1
 [6,]          5.4         3.9          1.7         0.4       1
 [7,]          4.6         3.4          1.4         0.3       1
 [8,]          5.0         3.4          1.5         0.2       1
 [9,]          4.4         2.9          1.4         0.2       1
[10,]          4.9         3.1          1.5         0.1       1
```

## 3D Tensors | *Timeseries or sequence data*

<img src="images/timeseries_data.png" width=800/>


## 4D Tensors | *Image data*

<img src="images/image_data.png" width=450/>


## What is tensor "flow"? | A dataflow graph with nodes representing units of computation {.smaller}

<div class="columns-2">
  <img src="images/tensors_flowing.gif" style="margin-top: -38px; margin-left: 65px;"/>
 

  - **Parallelism**--System identifies operations that can execute in parallel.
  - **Distributed execution**--Graph can be partitioned accross multiple devices.
  - **Compilation**--Use the information in your dataflow graph to generate faster code (e.g. fusing operations)
  - **Portability**--Dataflow graph is a language-independent representation of the code in your model (deploy with C++ runtime)
</div>

## Why should R users care about TensorFlow?

- A new general purpose numerical computing library with many potential applications! 

- Models created with TensorFlow can be deployed with a low-latency C++ runtime

- Robust foundation for many deep learning applications

- R has a lot to offer as an *interface language* for TensorFlow

## Example: Greta | Writing statistical models and fitting them by MCMC

<img src="images/greta.png" width=650px style="margin-top: -38px;" class="illustration"/>

<https://greta-dev.github.io/greta/>

## R Interface to Tensorflow

- High-level R interfaces for neural nets and traditional models

- Low-level interface to allow enable new applications (e.g. Greta)

- Tools to faciliate productive workflow / experiment management

- Easy access to GPUs for training models

- Breadth and depth of educational resources


## R Packages

| Package | Description |
|---|--------------|
| [keras](https://tensorflow.rstudio.com/keras/)  | Interface for neural networks, with a focus on enabling fast experimentation.  | 
| [tfestimators](https://tensorflow.rstudio.com/tfestimators/)  | Implementations of common model types such as regressors and classifiers. | 
| [tensorflow](https://tensorflow.rstudio.com/tensorflow/)  |  Low-level interface to the TensorFlow computational graph. | 
| [tfdatasets](https://tensorflow.rstudio.com/tools/tfdatasets/)  | Scalable input pipelines for TensorFlow models. | 
| [tfruns](https://tensorflow.rstudio.com/tools/tfruns/)  | Track, visualize, and manage TensorFlow training runs and experiments. | 
| [tfdeploy](https://tensorflow.rstudio.com/tools/tfdeploy/)  | Tools designed to make exporting and serving TensorFlow models straightforward.  | 
| [cloudml](https://tensorflow.rstudio.com/tools/cloudml/)  | R interface to Google Cloud Machine Learning Engine.  | 



## Keras Momentum

<div class="columns-2">

<img src="images/keras-search.png" width=450 class="illustration"/>

<img src="images/keras-search.png" width=450/>

</div>


## Slide with Bullets

- Bullet 1
- Bullet 2
- Bullet 3

## Slide with R Output

```{r cars, echo = TRUE}
summary(cars)
```

## Slide with Plot

```{r pressure}
plot(pressure)
```

